(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{228:function(e){e.exports=JSON.parse('{"headerApp":"Mordor","loginButton":"Login","logoutButton":"Logout","profileButton":"Profile","fandomsButton":"Fandoms","usersButton":"Users","searchButton":"Search","recentlyUpdated":"Recently updated","topFandoms":"Top fandoms of the week","tags":"Tags","lastUpdatedFooter":"Last updated ","loggedInToast":" logged in","loggedOutToast":"You logged out","noResults":"No results found","noPage":"404. Not found","userNotFound":"This user doesn\'t exist","usernameProfile":"Username:","emailProfile":"Email:","createBookButton":"Create fandom","titleProfile":"Title","genreProfile":"Genre","tagsProfile":"Tags","editProfile":"Edit","viewProfile":"View","ratingProfile":"Rating","createdAtProfile":"Publication date","noTagsProfile":"No tags","addReply":"Add reply","chaptersViewer":"Chapters:","setRatingViewer":"Rate","ratingViewer":"Rating:","tagsViewer":"Tags:","titleViewer":"Title:","genreViewer":"Genre:","descViewer":"Description:","authorViewer":"Author:","commentsViewer":"Comments","noBook":"No fandom found","addTag":"Add new tag: ","tagsPlaceholder":"Start typing...","signIn":"Sign In","signUp":"Sign Up","username":"Username","email":"Email","password":"Password","createAccount":"Create an account","wrongInfo":"Username or password is wrong","logIn":"Sign in","blockAlert":"Users are blocked","unblockAlert":"Users are unblocked","deleteAlert":"Users are deleted","blockButton":"Block","unblockButton":"Unblock","deleteButton":"Delete","usernameTable":"Username","emailTable":"Email","registrationDate":"Registration date","roleTable":"Role","statusTable":"Status","adventure":"Adventure","action":"Action","fantasy":"Fantasy","detective":"Detective","romance":"Romance","sci-fi":"Sci-Fi","horror":"Horror","thriller":"Thriller","erotic":"Erotic","logInTwitter":"Sign in with Twitter","logInVK":"Sign in with VK","logInGoogle":"Sign in with Google","logInFacebook":"Sign in with Facebook"}')},294:function(e){e.exports=JSON.parse('{"headerApp":"\u041c\u043e\u0440\u0434\u043e\u0440","loginButton":"\u0412\u043e\u0439\u0442\u0438","logoutButton":"\u0412\u044b\u0439\u0442\u0438","profileButton":"\u041f\u0440\u043e\u0444\u0438\u043b\u044c","fandomsButton":"\u0424\u0430\u043d\u0434\u043e\u043c\u044b","usersButton":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438","searchButton":"\u041f\u043e\u0438\u0441\u043a","recentlyUpdated":"\u041d\u0435\u0434\u0430\u0432\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0435","topFandoms":"\u041b\u0443\u0447\u0448\u0438\u0435 \u0444\u0430\u043d\u0434\u043e\u043c\u044b \u0437\u0430 \u043d\u0435\u0434\u0435\u043b\u044e","tags":"T\u0435\u0433\u0438","lastUpdatedFooter":"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e ","loggedInToast":" \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043b\u0441\u044f","loggedOutToast":"\u0412\u044b \u0432\u044b\u0448\u043b\u0438","noResults":"\u041f\u043e \u0432\u0430\u0448\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e","noPage":"404. \u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430","userNotFound":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d","usernameProfile":"\u041d\u0438\u043a\u043d\u0435\u0439\u043c:","emailProfile":"\u042d\u043b. \u043f\u043e\u0447\u0442\u0430:","createBookButton":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u043d\u0444\u0438\u043a","titleProfile":"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","genreProfile":"\u0416\u0430\u043d\u0440","tagsProfile":"\u0422\u0435\u0433\u0438","editProfile":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c","viewProfile":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c","ratingProfile":"\u0420\u0435\u0439\u0442\u0438\u043d\u0433","createdAtProfile":"\u0414\u0430\u0442\u0430 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438","noTagsProfile":"\u0422\u0435\u0433\u0438 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","addReply":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","chaptersViewer":"\u0413\u043b\u0430\u0432\u044b:","setRatingViewer":"\u041e\u0446\u0435\u043d\u0438\u0442\u044c","ratingViewer":"\u0420\u0435\u0439\u0442\u0438\u043d\u0433:","tagsViewer":"\u0422\u0435\u0433\u0438:","titleViewer":"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435:","genreViewer":"\u0416\u0430\u043d\u0440:","descViewer":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435:","authorViewer":"\u0410\u0432\u0442\u043e\u0440:","commentsViewer":"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438","noBook":"\u0424\u0430\u043d\u0434\u043e\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d","addTag":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u0435\u0433: ","tagsPlaceholder":"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c...","signIn":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f","signUp":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f","username":"\u041d\u0438\u043a\u043d\u0435\u0439\u043c","email":"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430","password":"\u041f\u0430\u0440\u043e\u043b\u044c","createAccount":"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f","wrongInfo":"\u041b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0435","logIn":"\u0412\u043e\u0439\u0442\u0438","blockAlert":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u044b","unblockAlert":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u044b","deleteAlert":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u044b","blockButton":"\u0417\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c","unblockButton":"\u0420\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c","deleteButton":"\u0423\u0434\u0430\u043b\u0438\u0442\u044c","usernameTable":"\u041d\u0438\u043a\u043d\u0435\u0439\u043c","emailTable":"\u042d\u043b. \u043f\u043e\u0447\u0442\u0430","registrationDate":"\u0414\u0430\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438","roleTable":"\u0420\u043e\u043b\u044c","statusTable":"\u0421\u0442\u0430\u0442\u0443\u0441","adventure":"\u041f\u0440\u0438\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435","action":"\u042d\u043a\u0448\u043d","fantasy":"\u0424\u044d\u043d\u0442\u0435\u0437\u0438","detective":"\u0414\u0435\u0442\u0435\u043a\u0442\u0438\u0432","romance":"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u043a\u0430","sci-fi":"\u041d\u0430\u0443\u0447\u043d\u0430\u044f \u0444\u0430\u043d\u0442\u0430\u0441\u0442\u0438\u043a\u0430","horror":"\u0423\u0436\u0430\u0441\u044b","thriller":"\u0422\u0440\u0438\u043b\u043b\u0435\u0440","erotic":"\u042d\u0440\u043e\u0442\u0438\u043a\u0430","logInTwitter":"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 Twitter","logInVK":"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 \u0412\u041a","logInGoogle":"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 Google","logInFacebook":"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 Facebook"}')},321:function(e,t,a){},513:function(e,t,a){"use strict";a.r(t);a(315),a(316);var s=a(0),n=a(30),r=a.n(n),o=a(18),i=a(54),c=(a(321),a(65)),l=a(74),d=a.n(l),u=a(116),h=a(14),j=a(57),b=a(25),p=a(26),g=a(16),m=a(28),O=a(27),f=a(43),x=a(547),v=a(2),k=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"render",value:function(){return Object(v.jsxs)("div",{className:"card border-info mb-3 mt-3",children:[Object(v.jsxs)("div",{className:"card-body text-info",children:[Object(v.jsx)(f.a,{to:"/view/".concat(this.props.title),children:Object(v.jsx)("h3",{className:"card-text",children:this.props.title})}),Object(v.jsx)(f.a,{to:"/profile/".concat(this.props.author),children:Object(v.jsx)("small",{className:"text-muted",children:this.props.author})}),Object(v.jsx)("p",{className:"card-text",children:this.props.description})]}),Object(v.jsx)("div",{className:"card-footer",children:Object(v.jsxs)("small",{className:"text-muted",children:[Object(v.jsx)(x.a,{id:"lastUpdatedFooter",defaultMessage:"Last updated"}),new Date(this.props.updatedAt).toLocaleDateString()]})})]})}}]),a}(s.Component),w=Object(o.g)(k),y=a(159),S=a.n(y),C=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"render",value:function(){return Object(v.jsxs)("div",{className:"card border-info mb-3 mt-3",children:[Object(v.jsxs)("div",{className:"card-body text-info",children:[Object(v.jsx)(f.a,{to:"/view/".concat(this.props.title),children:Object(v.jsx)("h3",{className:"card-text",children:this.props.title})}),Object(v.jsx)(f.a,{to:"/profile/".concat(this.props.author),children:Object(v.jsx)("small",{className:"text-muted",children:this.props.author})}),Object(v.jsx)("p",{className:"card-text",children:this.props.description})]}),Object(v.jsx)("div",{className:"card-footer",children:Object(v.jsxs)("div",{className:"row d-flex",children:[Object(v.jsx)("div",{className:"col-md-4",children:Object(v.jsx)(S.a,{value:this.props.rating,edit:!1,count:5,isHalf:!0,size:18,activeColor:"#ffd700"})}),Object(v.jsx)("div",{className:"offset-col-md-4 small text",children:this.props.rating.toPrecision(2)})]})})]})}}]),a}(s.Component),N=Object(o.g)(C),I=a(282),T=a(17),B=a.n(T),L=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){var e;return Object(b.a)(this,a),(e=t.call(this)).state={allTags:[]},e.getTags=e.getTags.bind(Object(g.a)(e)),e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){this.getTags()}},{key:"getTags",value:function(){var e=this;B.a.get("/book/getTags").then((function(t){t.data.map((function(t){return t.tags&&t.tags.map((function(t){return delete t.customOption,e.setState((function(e){return{allTags:[].concat(Object(c.a)(e.allTags),[t])}})),t})),t}))}))}},{key:"render",value:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)("div",{className:"container mt-3",children:Object(v.jsxs)("div",{className:"row xl-3",children:[Object(v.jsxs)("div",{name:"recent",className:"col",children:[Object(v.jsx)("h3",{children:Object(v.jsx)(x.a,{id:"recentlyUpdated",defaultMessage:"Recently updated"})}),JSON.parse(localStorage.getItem("books")).filter((function(e){return new Date(e.updatedAt)>new Date(Date.now()-6048e5)})).sort((function(e,t){return e.updatedAt<t.updatedAt?1:e.updatedAt>t.updatedAt?-1:0})).map((function(e,t){return Object(v.jsx)(w,{title:e.title,description:e.description,author:e.author,updatedAt:e.updatedAt},e.id)}))]}),Object(v.jsxs)("div",{name:"top",className:"col",children:[Object(v.jsx)("h3",{children:Object(v.jsx)(x.a,{id:"topFandoms",defaultMessage:"Top fandoms of the week"})}),JSON.parse(localStorage.getItem("books")).slice(0,5).filter((function(e){return new Date(e.createdAt)>new Date(Date.now()-6048e5)})).sort((function(e,t){return t.rating-e.rating})).map((function(e,t){return Object(v.jsx)(N,{title:e.title,description:e.description,author:e.author,rating:e.ratingCount?e.rating/e.ratingCount:0},e.id)}))]}),Object(v.jsxs)("div",{name:"tags",className:"col",children:[Object(v.jsx)("h3",{children:Object(v.jsx)(x.a,{id:"tags",defaultMessage:"Tags"})}),Object(v.jsx)(I.TagCloud,{minSize:16,maxSize:48,tags:(e=this.state.allTags,Object(c.a)(new Set(e.map((function(e){return JSON.stringify(e)})))).map((function(e){return JSON.parse(e)})))})]})]})})});var e}}]),a}(s.Component),A=a(542);B.a.defaults.withCredentials=!0;var P=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(e){var s;return Object(b.a)(this,a),(s=t.call(this,e)).handleInputChange=function(e){s.setState(Object(j.a)({},e.target.name,e.target.value))},s.state={username:"",password:"",alert:{login:!1}},s.onClickLogin=s.onClickLogin.bind(Object(g.a)(s)),s.onClickLoginTwitter=s.onClickLoginTwitter.bind(Object(g.a)(s)),s.onClickLoginVK=s.onClickLoginVK.bind(Object(g.a)(s)),s.onClickLoginGoogle=s.onClickLoginGoogle.bind(Object(g.a)(s)),s}return Object(p.a)(a,[{key:"onClickLoginTwitter",value:function(){window.location.href="https://itransition-coursework.herokuapp.com/user/auth/twitter/callback"}},{key:"onClickLoginVK",value:function(){window.location.href="https://itransition-coursework.herokuapp.com/user/auth/vkontakte/callback"}},{key:"onClickLoginGoogle",value:function(){window.location.href="https://itransition-coursework.herokuapp.com/user/auth/google/callback"}},{key:"onClickLogin",value:function(){var e=this,t=this.state,a=t.username,s=t.password;B.a.post("user/login",{username:a,password:s}).then((function(t){t.data.message?e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{login:!0})}})):(console.log(t.data),e.props.handleSuccessfulAuth(t.data))}))}},{key:"render",value:function(){var e=this;return Object(v.jsxs)("div",{className:"login",children:[Object(v.jsx)("h3",{className:"mb-3 mt-5 text-center",children:Object(v.jsx)(x.a,{id:"signIn"})}),Object(v.jsxs)("div",{className:"container",children:[Object(v.jsxs)("div",{className:"row mb-3 mt-5 justify-content-center",children:[Object(v.jsx)("label",{className:"form-label",children:Object(v.jsx)(x.a,{id:"username"})}),Object(v.jsx)("input",{type:"text",className:"col-6 ml-3 form-control",name:"username",onChange:this.handleInputChange})]}),Object(v.jsxs)("div",{className:"row justify-content-center",children:[Object(v.jsx)("label",{className:"form-label",children:Object(v.jsx)(x.a,{id:"password"})}),Object(v.jsx)("input",{type:"password",className:"col-6 ml-3 form-control",name:"password",onChange:this.handleInputChange})]}),Object(v.jsx)("div",{className:"row mt-5 justify-content-center",children:Object(v.jsx)("button",{type:"button",onClick:this.onClickLogin,className:"btn btn-outline-primary",children:Object(v.jsx)(x.a,{id:"logIn"})})}),Object(v.jsxs)("div",{className:"row mt-5 justify-content-center",children:[Object(v.jsx)("button",{type:"button",onClick:this.onClickLoginTwitter,className:"btn btn-primary",children:Object(v.jsx)(x.a,{id:"logInTwitter"})}),Object(v.jsx)("button",{type:"button",onClick:this.onClickLoginVK,className:"ml-2 btn btn-info",children:Object(v.jsx)(x.a,{id:"logInVK"})}),Object(v.jsx)("button",{type:"button",onClick:this.onClickLoginGoogle,className:"ml-2 btn btn-danger",children:Object(v.jsx)(x.a,{id:"logInGoogle"})})]})]}),Object(v.jsx)("h3",{className:"mt-5 text-center",children:Object(v.jsx)(f.a,{to:"/register",className:"register_link",children:Object(v.jsx)(x.a,{id:"createAccount"})})}),Object(v.jsx)("div",{children:Object(v.jsx)(A.a,{style:{position:"absolute",top:100,right:40},show:this.state.alert.login,onClose:function(){e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{login:!1})}}))},delay:2e3,autohide:!0,children:Object(v.jsx)(A.a.Header,{children:Object(v.jsx)("strong",{children:Object(v.jsx)(x.a,{id:"wrongInfo"})})})})})]})}}]),a}(s.Component);B.a.defaults.withCredentials=!0;var R=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(e){var s;return Object(b.a)(this,a),(s=t.call(this,e)).handleInputChange=function(e){s.setState(Object(j.a)({},e.target.name,e.target.value))},s.onClickRegister=function(){var e=s.state,t=e.username,a=e.email,n=e.password;B.a.post("/user/register",{username:t,email:a,password:n}).then((function(e){console.log(e),e.data.message||s.props.handleSuccessfulAuth(e.data)}))},s.state={username:"",email:"",password:""},s}return Object(p.a)(a,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"register",children:Object(v.jsxs)("form",{children:[Object(v.jsx)("h3",{className:"mb-3 text-center",children:Object(v.jsx)(x.a,{id:"signUp"})}),Object(v.jsxs)("div",{className:"container",children:[Object(v.jsxs)("div",{className:"mb-3 mt-5 row justify-content-center",children:[Object(v.jsx)("label",{className:"col-2 form-label",children:Object(v.jsx)(x.a,{id:"username"})}),Object(v.jsx)("input",{type:"text",className:"col-3 form-control",name:"username",onChange:this.handleInputChange})]}),Object(v.jsxs)("div",{className:"mb-3 row justify-content-center",children:[Object(v.jsx)("label",{className:"col-2 form-label",children:Object(v.jsx)(x.a,{id:"email"})}),Object(v.jsx)("input",{type:"email",className:"col-3 form-control",name:"email",onChange:this.handleInputChange})]}),Object(v.jsxs)("div",{className:"row justify-content-center",children:[Object(v.jsx)("label",{className:"col-2 form-label",children:Object(v.jsx)(x.a,{id:"password"})}),Object(v.jsx)("input",{type:"password",className:"col-3 form-control",name:"password",onChange:this.handleInputChange})]}),Object(v.jsx)("div",{className:"mt-5 row justify-content-center",children:Object(v.jsx)("button",{type:"button",onClick:this.onClickRegister,className:"btn btn-outline-primary",children:"Submit"})})]})]})})}}]),a}(s.Component),D=a(285),U=a(163),V=a.n(U),M=a(530);B.a.defaults.withCredentials=!0;var F=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(e){var s;return Object(b.a)(this,a),(s=t.call(this,e)).state={users:[],selectedRows:[],alert:{block:!1,unblock:!1,delete:!1}},s.blockUsers=s.blockUsers.bind(Object(g.a)(s)),s.unblockUsers=s.unblockUsers.bind(Object(g.a)(s)),s.deleteUsers=s.deleteUsers.bind(Object(g.a)(s)),s.getData=s.getData.bind(Object(g.a)(s)),s.showBlockAlert=s.showBlockAlert.bind(Object(g.a)(s)),s.showUnblockAlert=s.showUnblockAlert.bind(Object(g.a)(s)),s.showDeleteAlert=s.showDeleteAlert.bind(Object(g.a)(s)),s}return Object(p.a)(a,[{key:"getData",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,200)}));case 2:return t=[],e.next=5,B.a.get("/user/usersTable").then((function(e){return e.data})).catch((function(e){console.log(e),a.props.history.push("/")}));case 5:t=e.sent,this.setState({users:t});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.getData()}},{key:"showBlockAlert",value:function(){var e=this;this.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{block:!0})}})),setTimeout((function(){e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{block:!1})}}))}),2e3)}},{key:"showUnblockAlert",value:function(){var e=this;this.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{unblock:!0})}})),setTimeout((function(){e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{unblock:!1})}}))}),2e3)}},{key:"showDeleteAlert",value:function(){var e=this;this.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{delete:!0})}})),setTimeout((function(){e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{delete:!1})}}))}),2e3)}},{key:"blockUsers",value:function(){var e=this,t=this.state.selectedRows;B.a.post("/table/block",{selectedRows:t}).then((function(a){a&&(t.includes(parseInt(e.props.userId))?e.handleLogoutClick():(e.showBlockAlert(),e.getData()))}))}},{key:"unblockUsers",value:function(){var e=this,t=this.state.selectedRows;B.a.post("/table/unblock",{selectedRows:t}).then((function(t){t&&(e.showUnblockAlert(),e.getData())}))}},{key:"deleteUsers",value:function(){var e=this,t=this.state.selectedRows;B.a.post("/table/delete",{selectedRows:t}).then((function(a){a&&(t.includes(parseInt(e.props.userId))?e.handleLogoutClick():(e.showDeleteAlert(),e.getData()))}))}},{key:"render",value:function(){var e=this,t=[{dataField:"id",text:"ID"},{dataField:"username",text:Object(v.jsx)(x.a,{id:"usernameTable"}),formatter:function(e,t){return Object(v.jsxs)(f.a,{to:"/profile/".concat(e),children:[" ",e," "]})}},{dataField:"email",text:Object(v.jsx)(x.a,{id:"emailTable"})},{dataField:"createdAt",text:Object(v.jsx)(x.a,{id:"registrationDate"}),formatter:function(e,t){return new Date(e).toLocaleDateString()}},{dataField:"role",text:Object(v.jsx)(x.a,{id:"roleTable"})},{dataField:"status",text:Object(v.jsx)(x.a,{id:"statusTable"})}];return Object(v.jsxs)("div",{className:"container mt-3",children:[Object(v.jsx)(M.a,{show:this.state.alert.block,variant:"danger",children:Object(v.jsx)("p",{children:Object(v.jsx)(x.a,{id:"blockAlert"})})}),Object(v.jsx)(M.a,{show:this.state.alert.unblock,variant:"danger",children:Object(v.jsx)("p",{children:Object(v.jsx)(x.a,{id:"unblockAlert"})})}),Object(v.jsx)(M.a,{show:this.state.alert.delete,variant:"danger",children:Object(v.jsx)("p",{children:Object(v.jsx)(x.a,{id:"deleteAlert"})})}),Object(v.jsxs)("div",{className:"btn-group mb-3",role:"group",children:[Object(v.jsx)("button",{onClick:this.blockUsers,type:"button",className:"btn btn-outline-primary",children:Object(v.jsx)(x.a,{id:"blockButton"})}),Object(v.jsx)("button",{onClick:this.unblockUsers,type:"button",className:"btn btn-outline-primary",children:Object(v.jsx)(x.a,{id:"unblockButton"})}),Object(v.jsx)("button",{onClick:this.deleteUsers,type:"button",className:"btn btn-outline-danger",children:Object(v.jsx)(x.a,{id:"deleteButton"})})]}),Object(v.jsx)(V.a,{keyField:"id",noDataIndication:"Table is Empty",data:this.state.users,columns:t,hiddenRows:[5],wrapperClasses:"table-responsive",selectRow:{mode:"checkbox",clickToSelect:!0,onSelectAll:function(t,a,s){if(t){var n,r=Object(D.a)(a);try{var o=function(){var t=n.value;e.setState((function(e){return{selectedRows:[].concat(Object(c.a)(e.selectedRows),[t.id])}}))};for(r.s();!(n=r.n()).done;)o()}catch(i){r.e(i)}finally{r.f()}}else e.setState({selectedRows:[]})},onSelect:function(t,a){a?e.setState((function(e){return{selectedRows:[].concat(Object(c.a)(e.selectedRows),[t.id])}})):e.setState({selectedRows:e.state.selectedRows.filter((function(e){return e!==t.id}))})}}})]})}}]),a}(s.Component),J=Object(o.g)(F),E=a(531),G=a(532),K=a(533),H=a(534),z=a(539),W=a(286),Y=a.n(W),_=a(148),q=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){var e;return Object(b.a)(this,a),(e=t.call(this)).handleChange=function(t){e.setState(Object(j.a)({},t.target.name,t.target.value))},e.state={id:void 0,profileId:void 0,username:"",profileUsername:"",email:"",profileEmail:"",books:[],isLoading:!0},e.getBooks=e.getBooks.bind(Object(g.a)(e)),e}return Object(p.a)(a,[{key:"getBooks",value:function(){var e=this,t=this.props.match.params.id;B.a.get("/book/userBooks",{params:{username:t}}).then((function(t){e.setState({books:t.data})}))}},{key:"deleteBook",value:function(e){var t=this,a=e;B.a.post("/book/deleteBook",{ID:a}).then((function(e){t.setState({books:t.state.books.filter((function(e){return e.id!==a}))})}))}},{key:"getUserData",value:function(){var e=this;B.a.get("/user/userData").then((function(t){"error"!==t.data.status?e.setState({id:t.data.id,username:t.data.username,email:t.data.email,role:t.data.role},(function(){return e.setState({isLoading:!1})})):e.setState({isLoading:!1})}))}},{key:"getProfileData",value:function(){var e=this;B.a.get("/user/profileData",{params:{username:this.props.match.params.id}}).then((function(t){e.setState({profileId:t.data.id,profileUsername:t.data.username,profileEmail:t.data.email})}))}},{key:"componentDidMount",value:function(){this.getBooks(),this.getProfileData(),this.getUserData()}},{key:"render",value:function(){var e=this,t=this.state.isLoading;if(t)return Object(v.jsx)("div",{children:Object(v.jsx)(E.a,{animation:"border",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})});if(!t&&!this.state.profileId)return Object(v.jsx)("div",{children:Object(v.jsx)("h3",{className:"mt-5 text-center",children:"This user doesn't exist"})});var a=[{dataField:"title",text:Object(v.jsx)(x.a,{id:"titleProfile",defaultMessage:"Title"}),sort:!0},{dataField:"genre",text:Object(v.jsx)(x.a,{id:"genreProfile",defaultMessage:"Genre"})},{dataField:"tags",text:Object(v.jsx)(x.a,{id:"tagsProfile",defaultMessage:"Tags"}),formatter:function(e,t){return e?e.map((function(e,t){return Object(v.jsx)(G.a,{className:"mr-2 p-2",variant:"secondary",children:e.label},t)})):Object(v.jsx)(x.a,{id:"noTagsProfile",defaultMessage:"No tags"})}},{dataField:"rating",text:Object(v.jsx)(x.a,{id:"ratingProfile",defaultMessage:"Rating"}),formatter:function(e,t){return 0!==t.ratingCount?(e/t.ratingCount).toPrecision(2):0},sort:!0},{dataField:"createdAt",text:Object(v.jsx)(x.a,{id:"createdAtProfile",defaultMessage:"Publication date"}),formatter:function(e,t){return new Date(e).toLocaleDateString()},sort:!0},{dataField:"Edit",text:"",align:"center",formatter:function(e,t){return Object(v.jsx)(f.a,{to:{pathname:"/edit/".concat(t.title),state:{bookid:t.title}},children:Object(v.jsx)(K.a,{variant:"secondary",children:Object(v.jsx)(x.a,{id:"editProfile",defaultMessage:"Edit"})})})},hidden:this.state.username!==this.state.profileUsername&&"admin"!==this.props.role},{dataField:"View",text:"",align:"center",formatter:function(e,t){return Object(v.jsx)(f.a,{to:"/view/".concat(t.title),children:Object(v.jsx)(K.a,{variant:"secondary",children:Object(v.jsx)(x.a,{id:"viewProfile",defaultMessage:"View"})})})}},{dataField:"Delete",text:"",align:"center",formatter:function(t,a){return Object(v.jsxs)(K.a,{onClick:function(){return e.deleteBook(a.id)},children:[" ",Object(v.jsx)(_.b,{})," "]})},hidden:this.state.username!==this.state.profileUsername}];return Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(H.a,{className:"container mt-3",children:[Object(v.jsxs)("div",{className:"row mt-1",children:[Object(v.jsx)("div",{className:"mb-1",style:{fontSize:24,fontWeight:"bold",width:"auto"},children:Object(v.jsx)(x.a,{id:"usernameProfile",defaultMessage:"Username:"})}),Object(v.jsx)("div",{className:"p-1 ml-3",children:Object(v.jsx)(z.a.Control,{type:"text",placeholder:this.state.profileUsername,readOnly:!0})})]}),Object(v.jsxs)("div",{className:"row mt-1",children:[Object(v.jsx)("div",{className:"mb-1",style:{fontSize:24,fontWeight:"bold"},children:Object(v.jsx)(x.a,{id:"emailProfile",defaultMessage:"Email:"})}),Object(v.jsx)("div",{className:"p-1 ml-3",children:Object(v.jsx)(z.a.Control,{type:"text",placeholder:this.state.profileEmail,readOnly:!0})})]}),Object(v.jsxs)("div",{className:"container mt-3",children:[this.state.username===this.props.match.params.id?Object(v.jsx)("div",{className:"mt-3 mb-3",children:Object(v.jsx)(f.a,{to:"/createBook",children:Object(v.jsx)(K.a,{className:"shadow-sm",variant:"outline-success",children:Object(v.jsx)(x.a,{id:"createBookButton",defaultMessage:"Create fandom"})})})}):null,Object(v.jsx)(V.a,{bootstrap4:!0,keyField:"id",noDataIndication:"Table is Empty",data:this.state.books,columns:a,defaultSorted:[{dataField:"createdAt",order:"desc"}],wrapperClasses:"table-responsive",pagination:Y()()})]})]})})}}]),a}(s.Component),Q=Object(o.g)(q),X=a(297),Z=a(535),$=a(288),ee=a(548),te=a(536),ae=a(291),se=a(292),ne=a(229),re=a(198),oe=a(166),ie=a.n(oe),ce=a(219),le=a.n(ce),de=a(295);a(494),a(274);B.a.defaults.withCredentials=!0;var ue=function(e){return e.map((function(e,t){var a=e;return a.chapterId=t+1,a}))},he=function(e){return e.map((function(e,t){var a=e;return a.chapterName=t+1,a}))},je=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(e){var s;return Object(b.a)(this,a),(s=t.call(this,e)).handleValueChange=function(e,t){var a=s.state.chapters;a[t].text=e,s.setState({chapters:a})},s.handleTabChange=function(e){s.setState({activeTab:e})},s.deleteChapter=function(e){var t=s.state.chapters.filter((function(t){return t.chapterId!==e}));if(s.setState({chapters:t}),s.state.editMode){var a=s.state.bookId,n=e;B.a.post("/book/deleteChapter",{bookId:a,chapterId:n})}},s.state={editMode:!1,isLoading:!0,multiple:!0,bookId:"",tags:[],allTags:[],genre:"",activeNav:"write",desc:"",title:"",author:"",authorId:"",chapters:[{chapterId:1,id:"",chapterName:"1",text:"",BookId:""}]},s.createBook=s.createBook.bind(Object(g.a)(s)),s.updateBook=s.updateBook.bind(Object(g.a)(s)),s.onDragEnd=s.onDragEnd.bind(Object(g.a)(s)),s.addChapter=s.addChapter.bind(Object(g.a)(s)),s.deleteChapter=s.deleteChapter.bind(Object(g.a)(s)),s.getTags=s.getTags.bind(Object(g.a)(s)),s}return Object(p.a)(a,[{key:"openBook",value:function(){var e=this,t=this.props.match.params.bookid;this.getTags(),B.a.get("/book/openBook",{params:{title:t}}).then((function(t){e.setState({title:t.data.title,bookId:t.data.id,tags:t.data.tags,genre:t.data.genre,desc:t.data.description,author:t.data.author,authorId:t.data.authorId,chapters:t.data.Chapters},(function(){!e.state.chapters||"admin"!==e.props.role&&e.props.user!==e.state.author?e.props.history.push("/"):(e.state.chapters.map((function(e){return delete e.createdAt,delete e.updatedAt,e})),e.setState({isLoading:!1}))}))}))}},{key:"onDragEnd",value:function(e){if(e.destination){var t=function(e,t,a){var s=e,n=s.splice(t,1),r=Object(X.a)(n,1)[0];return s.splice(a,0,r),he(ue(s))}(this.state.chapters,e.source.index,e.destination.index);this.setState({chapters:t})}}},{key:"addChapter",value:function(){var e=this.state.chapters.length+1,t=this.state.chapters,a={BookId:this.state.bookId,chapterId:e,chapterName:e.toString(),text:""};t.push(a),this.setState({chapters:t})}},{key:"componentDidMount",value:function(){var e=this;this.setState({author:this.props.user,authorId:this.props.userId}),this.props.location.pathname==="/edit/".concat(this.props.match.params.bookid)?this.setState({editMode:!0},(function(){return e.openBook()})):this.setState({isLoading:!1})}},{key:"createBook",value:function(){var e=this.state,t=e.author,a=e.authorId,s=e.tags,n=e.genre,r=e.desc,o=e.title,i=e.chapters;B.a.post("/book/createBook",{author:t,authorId:a,tags:s,genre:n,desc:r,title:o,chapters:i}).then((function(e){})),this.props.history.push("/view/".concat(o))}},{key:"updateBook",value:function(){var e=this.state,t=e.author,a=e.authorId,s=e.tags,n=e.genre,r=e.desc,o=e.title,i=e.bookId,c=e.chapters;B.a.post("/book/updateBook",{author:t,authorId:a,tags:s,genre:n,desc:r,title:o,bookId:i,chapters:c}).then((function(e){})),this.props.history.push("/view/".concat(o))}},{key:"getTags",value:function(){var e=this;B.a.get("/book/getTags").then((function(t){t.data.map((function(t){return t.tags&&t.tags.map((function(t){return delete t.customOption,e.setState((function(e){return{allTags:[].concat(Object(c.a)(e.allTags),[t])}})),t})),t}))}))}},{key:"render",value:function(){var e=this;if(this.state.isLoading)return Object(v.jsx)("div",{children:Object(v.jsx)(E.a,{animation:"border",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})});var t,a=[{value:"fantasy",label:Object(v.jsx)(x.a,{id:"fantasy"})},{value:"action",label:Object(v.jsx)(x.a,{id:"action"})},{value:"adventure",label:Object(v.jsx)(x.a,{id:"adventure"})},{value:"detective",label:Object(v.jsx)(x.a,{id:"detective"})},{value:"romance",label:Object(v.jsx)(x.a,{id:"romance"})},{value:"sci-fi",label:Object(v.jsx)(x.a,{id:"sci-fi"})},{value:"horror",label:Object(v.jsx)(x.a,{id:"horror"})},{value:"thriller",label:Object(v.jsx)(x.a,{id:"thriller"})},{value:"erotic",label:Object(v.jsx)(x.a,{id:"erotic"})}];return Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)("div",{className:"mt-4",children:[Object(v.jsxs)(z.a,{children:[Object(v.jsxs)(z.a.Group,{as:Z.a,children:[Object(v.jsx)(z.a.Label,{column:!0,sm:2,children:Object(v.jsx)(x.a,{id:"titleViewer"})}),Object(v.jsx)($.a,{sm:6,children:Object(v.jsx)(z.a.Control,{value:this.state.title,onChange:function(t){e.setState({title:t.target.value})},type:"text"})})]}),Object(v.jsxs)(z.a.Group,{as:Z.a,children:[Object(v.jsx)(z.a.Label,{column:!0,sm:2,children:Object(v.jsx)(x.a,{id:"descViewer"})}),Object(v.jsx)($.a,{sm:6,children:Object(v.jsx)(z.a.Control,{as:"textarea",rows:3,value:this.state.desc,onChange:function(t){e.setState({desc:t.target.value})},type:"text"})})]}),Object(v.jsxs)(z.a.Group,{as:Z.a,children:[Object(v.jsx)(z.a.Label,{column:!0,sm:2,children:Object(v.jsx)(x.a,{id:"tagsViewer"})}),Object(v.jsx)($.a,{sm:6,children:Object(v.jsx)(s.Fragment,{children:Object(v.jsx)(ne.b,Object(h.a)(Object(h.a)({},this.state),{},{allowNew:!0,highlightOnlyResult:!1,newSelectionPrefix:Object(v.jsx)(x.a,{id:"addTag"}),id:"tags-token",defaultSelected:this.state.tags?this.state.tags:[],options:this.state.allTags.length>0?(t=this.state.allTags,Object(c.a)(new Set(t.map((function(e){return JSON.stringify(e)})))).map((function(e){return JSON.parse(e)}))):[],labelKey:"value",onChange:function(t){return e.setState({tags:t})},renderToken:function(e,t,a){var s=t.onRemove;return Object(v.jsx)(ne.a,{option:e,onRemove:s,children:"".concat(e.value)},a)}}))})})]}),Object(v.jsxs)(z.a.Group,{as:Z.a,children:[Object(v.jsx)(z.a.Label,{column:!0,sm:2,children:Object(v.jsx)(x.a,{id:"genreViewer"})}),Object(v.jsx)($.a,{sm:6,children:Object(v.jsx)(de.a,{defaultValue:{value:"default",label:this.state.genre},onChange:function(t){return e.setState({genre:t})},isSearchable:!1,options:a})})]})]}),Object(v.jsx)(ee.a,{style:{maxWidth:"45.5rem"},onClick:this.addChapter,children:Object(v.jsx)(ee.a.Header,{as:K.a,variant:"light",children:Object(v.jsx)(_.a,{})})}),Object(v.jsx)(re.a,{onDragEnd:this.onDragEnd,children:Object(v.jsx)(re.c,{droppableId:"droppable",children:function(t){return Object(v.jsx)("div",Object(h.a)(Object(h.a)({className:"col-xs"},t.droppableProps),{},{ref:t.innerRef,children:Object(v.jsxs)(te.a,{children:[e.state.chapters.map((function(t,a){return Object(v.jsx)(re.b,{draggableId:t.chapterId.toString(),index:a,children:function(s){return Object(v.jsx)("div",Object(h.a)(Object(h.a)(Object(h.a)({ref:s.innerRef},s.draggableProps),s.dragHandleProps),{},{children:Object(v.jsxs)(ee.a,{style:{maxWidth:"45.5rem"},children:[Object(v.jsxs)(ee.a.Header,{style:{display:"flex",alignItems:"center",margin:"0"},children:[Object(v.jsx)(ae.a,{as:K.a,variant:"link",eventKey:t.chapterId,children:e.state.editMode?"Chapter ".concat(t.chapterId):"Chapter ".concat(t.chapterName)}),a+1===e.state.chapters.length?Object(v.jsx)(K.a,{variant:"link",onClick:function(){e.deleteChapter(t.chapterId)},style:{marginLeft:"auto"},children:Object(v.jsx)(_.b,{})}):null]}),Object(v.jsx)(se.a,{eventKey:t.chapterId,children:Object(v.jsx)(le.a,{value:e.state.chapters[a].text,onChange:function(t){e.handleValueChange(t,a)},selectedTab:e.state.activeTab,onTabChange:e.handleTabChange,generateMarkdownPreview:function(e){return Promise.resolve(Object(v.jsx)(ie.a,{source:e}))}})})]},a)}))}},t.chapterId)})),t.placeholder]})}))}})}),Object(v.jsx)("div",{className:"mt-3",children:this.state.editMode?Object(v.jsx)(K.a,{onClick:this.updateBook,variant:"outline-success",children:"Update"}):Object(v.jsx)(K.a,{onClick:this.createBook,variant:"outline-success",children:"Publish"})})]})})}}]),a}(s.Component),be=Object(o.g)(je),pe=a(549),ge=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"render",value:function(){return Object(v.jsxs)("div",{className:"row mt-1",children:[Object(v.jsx)("div",{className:"p-1 mr-5",children:this.props.label}),Object(v.jsx)("div",{children:this.props.value})]})}}]),a}(s.Component),me=a(541),Oe=a(538),fe=a(544),xe=(a(503),a(504),a(505),a(506),function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(e){var s;return Object(b.a)(this,a),(s=t.call(this,e)).ws=new WebSocket(window.location.origin.replace(/^http/,"ws")+"/".concat(s.props.bookId)),s.handleInputChange=function(e){e.preventDefault(),s.setState(Object(j.a)({},e.target.name,e.target.value))},s.addCommentsFromServer=function(e){s.setState((function(t){return{comments:e}}))},s.state={comments:[],comment:""},s}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.ws.onopen=function(){console.log("Connected to server")},this.ws.onmessage=function(t){var a=JSON.parse(t.data);e.addCommentsFromServer(a)},this.ws.onclose=function(){console.log("Disconnected from server"),e.setState({ws:new WebSocket(window.location.origin.replace(/^http/,"ws")+"/".concat(e.props.bookId))})}}},{key:"addReply",value:function(){if(this.state.comment){var e={author:this.props.username,UserId:this.props.userId,BookId:this.props.bookId,text:this.state.comment};this.ws.send(JSON.stringify(e)),this.setState({comment:""})}}},{key:"render",value:function(){var e=this;return Object(v.jsxs)("div",{children:[Object(v.jsx)(me.a.Group,{size:"small",children:this.state.comments.map((function(e,t){return Object(v.jsx)(me.a,{children:Object(v.jsxs)(me.a.Content,{children:[Object(v.jsx)(me.a.Author,{as:"a",children:e.author}),Object(v.jsx)(me.a.Metadata,{children:Object(v.jsx)("div",{children:new Date(e.createdAt).toLocaleString("ru-RU")})}),Object(v.jsx)(me.a.Text,{children:e.text})]})},t)}))}),this.props.username?Object(v.jsxs)(Oe.a,{reply:!0,children:[Object(v.jsx)(Oe.a.TextArea,{value:this.state.comment,onChange:function(t){return e.handleInputChange(t)},name:"comment",width:8}),Object(v.jsx)(fe.a,{ws:this.ws,onClick:function(){return e.addReply()},content:Object(v.jsx)(x.a,{id:"addReply",defaultMessage:"Add reply"}),labelPosition:"left",icon:"edit",size:"small",primary:!0})]}):null]})}}]),a}(s.Component)),ve=Object(o.g)(xe);B.a.defaults.withCredentials=!0;var ke=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(e){var s;return Object(b.a)(this,a),(s=t.call(this,e)).pushChapters=function(){var e=[];return s.state.book.Chapters&&s.state.book.Chapters.sort((function(e,t){return e.chapterId>t.chapterId?1:e.chapterId<t.chapterId?-1:0})).map((function(t,a){return e.push(Object(v.jsx)(pe.a.Item,{onClick:function(){s.setActivePage(a),s.setState({comments:!1})},children:a+1},a)),e})),e},s.state={isLoading:!0,book:[],rating:void 0,activePage:"",editable:!0,comments:!1},s.setRating=s.setRating.bind(Object(g.a)(s)),s.setRatingBook=s.setRatingBook.bind(Object(g.a)(s)),s.setActivePage=s.setActivePage.bind(Object(g.a)(s)),s.pushChapters=s.pushChapters.bind(Object(g.a)(s)),s.isRated=s.isRated.bind(Object(g.a)(s)),s}return Object(p.a)(a,[{key:"componentDidMount",value:function(){void 0===this.props.user&&this.setState({editable:!1}),this.openBook()}},{key:"isRated",value:function(){var e=this,t=this.state.book.id,a=this.props.userId;B.a.get("/book/isRated",{params:{authorId:a,bookId:t}}).then((function(t){console.log(t),t.data.message?e.setState({editable:!1},(function(){return e.setState({isLoading:!1})})):e.setState({isLoading:!1})}))}},{key:"openBook",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.match.params.bookid,e.next=3,B.a.get("/book/openBook",{params:{title:t}}).then((function(e){a.setState({book:e.data},(function(){a.props.user?a.isRated():a.setState({isLoading:!1})}))})).catch((function(e){return console.log(e)}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setActivePage",value:function(e){this.setState({activePage:e})}},{key:"setRating",value:function(e){this.props.user?this.setState({rating:e}):console.log("You have to login to set a rating.")}},{key:"setRatingBook",value:function(){if(this.props.user){var e=this.props.user,t=this.state.book.id,a=this.state.book.rating,s=this.props.userId,n=this.state.book.ratingCount;B.a.post("/book/setRating",{author:e,authorId:s,bookId:t,rating:a,ratingCount:n}).then((function(e){console.log(e)}))}else console.log("You have to login to set a rating.")}},{key:"render",value:function(){var e=this;return this.state.isLoading?Object(v.jsx)("div",{children:Object(v.jsx)(E.a,{animation:"border",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})}):this.state.book?Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(H.a,{className:"container",children:[Object(v.jsx)(ge,{label:Object(v.jsx)(x.a,{id:"titleViewer"}),value:this.state.book.title}),Object(v.jsx)(ge,{label:Object(v.jsx)(x.a,{id:"authorViewer"}),value:this.state.book.author}),Object(v.jsx)(ge,{label:Object(v.jsx)(x.a,{id:"descViewer"}),value:this.state.book.description}),Object(v.jsx)(ge,{label:Object(v.jsx)(x.a,{id:"genreViewer"}),value:this.state.book.genre}),Object(v.jsxs)("div",{className:"row mt-1",children:[Object(v.jsx)("div",{className:"p-1 mr-5",children:Object(v.jsx)(x.a,{id:"tagsViewer"})}),this.state.book.tags?this.state.book.tags.map((function(e,t){return Object(v.jsx)(G.a,{className:"mr-2 p-2",variant:"secondary",children:e.value},t)})):null]}),Object(v.jsxs)("div",{className:"row mt-1",children:[Object(v.jsx)("div",{className:"p-1 mr-5",children:Object(v.jsx)(x.a,{id:"ratingViewer"})}),Object(v.jsx)(S.a,{value:this.state.book.rating/this.state.book.ratingCount,count:5,edit:!(!this.props.user||!this.state.editable),onChange:this.setRating,isHalf:!0,size:24,activeColor:"#ffd700"}),Object(v.jsx)("span",{className:"ml-3 mt-2",children:this.state.book.rating?(this.state.book.rating/this.state.book.ratingCount).toPrecision(2):0}),Object(v.jsx)(K.a,{className:"ml-3 p-1",onClick:function(){return e.setState((function(t){return{book:Object(h.a)(Object(h.a)({},t.book),{},{rating:e.state.editable?t.book.rating+e.state.rating:t.book.rating,ratingCount:e.state.editable?t.book.ratingCount+1:t.book.ratingCount}),editable:!1}}),(function(){return e.setRatingBook()}))},variant:"outline-success",children:Object(v.jsx)(x.a,{id:"setRatingViewer"})})]}),Object(v.jsxs)("div",{className:"row mt-1",children:[Object(v.jsx)("div",{className:"p-1 mr-5",children:Object(v.jsx)(x.a,{id:"chaptersViewer"})}),Object(v.jsxs)(pe.a,{children:[this.pushChapters(),Object(v.jsx)(pe.a.Item,{onClick:function(){e.setState((function(e){return{comments:!1===e.comments}}))},children:Object(v.jsx)(x.a,{id:"commentsViewer"})})]})]}),this.state.comments?Object(v.jsx)(ve,{username:this.props.user,userId:this.props.userId,bookId:this.state.book.id}):null,""!==this.state.activePage?Object(v.jsx)("div",{className:"row mt-5 ",children:Object(v.jsx)(ie.a,{children:this.state.book.Chapters[parseInt(this.state.activePage)].text})}):null]})}):Object(v.jsx)("div",{children:Object(v.jsx)("h3",{className:"mt-5 text-center",children:Object(v.jsx)(x.a,{id:"noBook"})})})}}]),a}(s.Component),we=Object(o.g)(ke),ye=a(298);var Se=Object(o.g)((function(e){var t=e.component,a=e.handleSuccessfulAuth,s=e.handleLogin,n=e.user,r=Object(ye.a)(e,["component","handleSuccessfulAuth","handleLogin","user"]);return Object(v.jsx)(o.b,Object(h.a)(Object(h.a)({},r),{},{render:function(e){return void 0===n?Object(v.jsx)(t,Object(h.a)({handleSuccessfulAuth:a,handleLogin:s,user:n},e)):Object(v.jsx)(o.a,{to:"/"})}}))})),Ce=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){var e;return Object(b.a)(this,a),(e=t.call(this)).state={book:void 0},e.getBook=e.getBook.bind(Object(g.a)(e)),e}return Object(p.a)(a,[{key:"getBook",value:function(e,t){var a=this;this.setState({book:e.find((function(e){return e.id===parseInt(t)}))},(function(){return a.setState({isLoading:!1})}))}},{key:"componentDidMount",value:function(){this.getBook(JSON.parse(localStorage.getItem("books")),this.props.result.ref)}},{key:"render",value:function(){if(!this.state.book)return Object(v.jsx)("div",{children:Object(v.jsx)(E.a,{animation:"border",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})});var e=this.state.book;return Object(v.jsx)(w,{title:e.title,description:e.description,author:e.author,updatedAt:e.updatedAt},e.id)}}]),a}(s.Component),Ne=a(543),Ie=a(545),Te=a(537),Be=a(287),Le=a(550),Ae=a(540),Pe=a(294),Re=a(228),De={en:Re,ru:Pe},Ue=a(509);a(510)(Ue),a(511)(Ue),a(512)(Ue);var Ve=Ue.multiLanguage("en","ru");B.a.defaults.withCredentials=!0;var Me=function(e){Object(m.a)(a,e);var t=Object(O.a)(a);function a(){var e;return Object(b.a)(this,a),(e=t.call(this)).handleInputChange=function(t){e.setState(Object(j.a)({},t.target.name,t.target.value))},e.handleLocale=function(){e.setState((function(e){return{locale:"en"===e.locale?"ru":"en"}}),localStorage.setItem("locale",e.state.locale))},e.state={search:"",alert:{login:!1,logout:!1},user:{id:void 0,username:void 0,email:void 0,role:void 0},isLoading:!0,chapters:[],comments:[],locale:"en",messages:Re},e.handleLogin=e.handleLogin.bind(Object(g.a)(e)),e.handleLogout=e.handleLogout.bind(Object(g.a)(e)),e.handleLogoutClick=e.handleLogoutClick.bind(Object(g.a)(e)),e.handleSuccessfulAuth=e.handleSuccessfulAuth.bind(Object(g.a)(e)),e.getBooks=e.getBooks.bind(Object(g.a)(e)),e.getTags=e.getTags.bind(Object(g.a)(e)),e.handleSearch=e.handleSearch.bind(Object(g.a)(e)),e}return Object(p.a)(a,[{key:"handleSuccessfulAuth",value:function(e){this.handleLogin(e)}},{key:"handleLogout",value:function(){this.showLogoutAlert(),this.setState({user:{id:void 0,username:void 0,email:void 0,role:void 0}}),this.props.history.push("/")}},{key:"showLogoutAlert",value:function(){this.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{logout:!0})}}))}},{key:"handleLogoutClick",value:function(){var e=this;B.a.get("/user/logout").then((function(t){e.handleLogout()}))}},{key:"showLoginAlert",value:function(){this.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{login:!0})}}))}},{key:"handleLogin",value:function(e){var t=this;this.showLoginAlert(),this.setState({user:{id:e.id,username:e.username,email:e.email,role:e.role}},(function(){return t.props.history.push({pathname:"/users",state:{user:t.state.user}})}))}},{key:"getBooks",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.a.get("/book/allBooks").then((function(e){localStorage.setItem("books",JSON.stringify(e.data))})).then((function(){return t.setState({isLoading:!1})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getUserData",value:function(){var e=this;B.a.get("/user/userData").then((function(t){"error"!==t.data.status&&e.setState({user:{id:t.data.id,username:t.data.username,email:t.data.email,role:t.data.role}})}))}},{key:"getTags",value:function(){var e=this;B.a.get("/book/getTags").then((function(t){t.data.map((function(t){return t.tags.map((function(t){return delete t.customOption,e.setState((function(e){return{allTags:[].concat(Object(c.a)(e.allTags),[t])}})),t})),t}))}))}},{key:"handleSearch",value:function(){var e=this.state.search;if(e){B.a.get("/book/allComments").then((function(e){localStorage.setItem("comments",JSON.stringify(e.data))})),B.a.get("/book/allChapters").then((function(e){localStorage.setItem("chapters",JSON.stringify(e.data))}));var t=Ue((function(){var e=this;this.use(Ve),this.ref("id"),this.field("author"),this.field("title"),this.field("description"),this.field("text"),JSON.parse(localStorage.getItem("books")).map((function(t){return e.add({id:t.id,title:t.title,author:t.author,description:t.description})})),JSON.parse(localStorage.getItem("comments")).map((function(t){return e.add({id:t.BookId,text:t.text})})),JSON.parse(localStorage.getItem("chapters")).map((function(t){return e.add({id:t.BookId,chapter:t.text})}))}));localStorage.setItem("searchResult",JSON.stringify(t.search(e))),this.props.history.replace({pathname:"/search/".concat(this.state.search)})}}},{key:"componentDidMount",value:function(){this.getUserData(),this.getBooks(),null===localStorage.getItem("locale")&&localStorage.setItem("locale","en")}},{key:"render",value:function(){var e=this;return this.state.isLoading?Object(v.jsx)("div",{children:Object(v.jsx)(E.a,{animation:"border",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})}):Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(Ae.a,{locale:localStorage.getItem("locale"),messages:De[localStorage.getItem("locale")],children:[Object(v.jsxs)(Ne.a,{collapseOnSelect:!0,sticky:"top",expand:"sm",bg:"light",variant:"light",children:[Object(v.jsx)(Ne.a.Brand,{href:"/",children:Object(v.jsx)("h3",{children:Object(v.jsx)(x.a,{id:"headerApp",defaultMessage:"Mordor"})})}),Object(v.jsx)(Ne.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(v.jsxs)(Ne.a.Collapse,{id:"responsive-navbar-nav",children:[Object(v.jsxs)(Ie.a,{className:"mr-auto",children:[this.state.user&&"admin"===this.state.user.role?Object(v.jsx)(Ie.a.Link,{href:"/users",children:Object(v.jsx)(K.a,{variant:"outline-primary",children:Object(v.jsx)(x.a,{id:"usersButton",defaultMessage:"Users"})})}):null,Object(v.jsx)(Ie.a.Link,{href:"/books",children:Object(v.jsx)(K.a,{variant:"outline-primary",children:Object(v.jsx)(x.a,{id:"fandomsButton",defaultMessage:"Fandoms"})})})]}),this.state.user&&this.state.user.username?Object(v.jsxs)(Ie.a,{className:"ml-auto",children:[Object(v.jsx)(Ie.a.Link,{children:Object(v.jsx)(K.a,{onClick:function(){return e.props.history.replace({pathname:"/profile/".concat(e.state.user.username),state:{user:e.state.user}})},variant:"primary",children:Object(v.jsx)(x.a,{id:"profileButton",defaultMessage:"Profile"})})}),Object(v.jsx)(Ie.a.Link,{children:Object(v.jsx)(K.a,{onClick:this.handleLogoutClick,variant:"outline-primary",children:Object(v.jsx)(x.a,{id:"logoutButton",defaultMessage:"Logout"})})})]}):Object(v.jsx)(Ie.a.Link,{href:"/login",children:Object(v.jsx)(K.a,{variant:"outline-primary",children:Object(v.jsx)(x.a,{id:"loginButton",defaultMessage:"Login"})})})]}),Object(v.jsx)(K.a,{onClick:this.handleLocale,variant:"outline-primary",children:localStorage.getItem("locale").toUpperCase()}),Object(v.jsx)("div",{className:"ml-lg-2 ml-md-2 ml-sm-2",children:Object(v.jsxs)(Te.a,{children:[Object(v.jsx)(Be.a,{type:"text",name:"search",onChange:this.handleInputChange}),Object(v.jsx)(Te.a.Prepend,{children:Object(v.jsx)(K.a,{variant:"outline-info",onClick:this.handleSearch,children:Object(v.jsx)(x.a,{id:"searchButton",defaultMessage:"Search"})})})]})})]}),Object(v.jsxs)("div",{className:"container",children:[Object(v.jsxs)(o.d,{children:[Object(v.jsx)(o.b,{exact:!0,path:"/",render:function(t){return Object(v.jsx)(L,Object(h.a)(Object(h.a)({},t),{},{books:e.state.books}))}}),Object(v.jsx)(o.b,{path:"/profile/:id",render:function(t){return Object(v.jsx)(Q,Object(h.a)(Object(h.a)({},t),{},{books:JSON.parse(localStorage.getItem("books")),role:e.state.user.role}))}}),Object(v.jsx)(o.b,{path:"/view/:bookid",render:function(t){return Object(v.jsx)(we,Object(h.a)(Object(h.a)({},t),{},{user:e.state.user.username,userId:e.state.user.id}))}}),Object(v.jsx)(o.b,{path:"/edit/:bookid",render:function(t){return e.state.user.username?Object(v.jsx)(be,Object(h.a)(Object(h.a)({},t),{},{role:e.state.user.role,user:e.state.user.username,userId:e.state.user.id})):Object(v.jsx)(o.a,{to:"/"})}}),Object(v.jsx)(o.b,{path:"/createBook",render:function(t){return e.state.user.username?Object(v.jsx)(be,Object(h.a)(Object(h.a)({},t),{},{user:e.state.user.username,userId:e.state.user.id})):Object(v.jsx)(o.a,{to:"/"})}}),Object(v.jsx)(Se,{path:"/login",component:P,handleSuccessfulAuth:this.handleSuccessfulAuth,handleLogin:this.handleLogin,user:this.state.user.username}),Object(v.jsx)(o.b,{path:"/register",render:function(t){return Object(v.jsx)(R,Object(h.a)(Object(h.a)({},t),{},{handleSuccessfulAuth:e.handleSuccessfulAuth,handleLogin:e.handleLogin}))}}),Object(v.jsx)(o.b,{path:"/users",render:function(t){return"admin"===e.state.user.role?Object(v.jsx)(J,Object(h.a)(Object(h.a)({},t),{},{user:e.state.user.username,userId:e.state.user.id})):Object(v.jsx)(o.a,{to:"/"})}}),Object(v.jsx)(o.b,{path:"/books",render:function(e){return Object(v.jsx)(Le.a,{children:JSON.parse(localStorage.getItem("books")).map((function(t,a){return Object(v.jsx)("div",{children:Object(s.createElement)(w,Object(h.a)(Object(h.a)({},e),{},{key:t.id,title:t.title,description:t.description,author:t.author,updatedAt:t.updatedAt}))},a)}))})}}),Object(v.jsx)(o.b,{path:"/search",render:function(t){return Object(v.jsx)(Le.a,{children:JSON.parse(localStorage.getItem("searchResult")).length>0?JSON.parse(localStorage.getItem("searchResult")).map((function(a,s){return Object(v.jsx)("div",{children:Object(v.jsx)(Ce,Object(h.a)(Object(h.a)({},t),{},{result:a,index:s,comments:e.state.comments,chapters:e.state.chapters}))},s)})):Object(v.jsx)("div",{children:Object(v.jsx)("h3",{className:"mt-5 text-center",children:Object(v.jsx)(x.a,{id:"noResults",defaultMessage:"No results found"})})})})}}),Object(v.jsx)(o.b,{path:"*",component:function(){return Object(v.jsx)("h3",{className:"text-center",children:"404 NOT FOUND"})}})]}),Object(v.jsx)("div",{children:Object(v.jsx)(A.a,{style:{position:"absolute",top:100,right:40},show:this.state.alert.logout,onClose:function(){e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{logout:!1})}}))},delay:3e3,autohide:!0,children:Object(v.jsx)(A.a.Header,{children:Object(v.jsx)("strong",{children:Object(v.jsx)(x.a,{id:"loggedOutToast",defaultMessage:"You logged out"})})})})}),Object(v.jsx)("div",{children:Object(v.jsx)(A.a,{style:{position:"absolute",top:100,right:40},show:this.state.alert.login,onClose:function(){e.setState((function(e){return{alert:Object(h.a)(Object(h.a)({},e.alert),{},{login:!1})}}))},delay:3e3,autohide:!0,children:Object(v.jsx)(A.a.Header,{children:Object(v.jsxs)("strong",{children:[this.state.user.username,Object(v.jsx)(x.a,{id:"loggedInToast",defaultMessage:"logged in"})]})})})})]})]})})}}]),a}(s.Component),Fe=Object(o.g)(Me);B.a.defaults.baseURL="https://itransition-coursework.herokuapp.com";var Je=Object(i.a)();r.a.render(Object(v.jsx)(o.c,{history:Je,children:Object(v.jsx)(Fe,{})}),document.getElementById("root"))}},[[513,1,2]]]);
//# sourceMappingURL=main.d0309cf6.chunk.js.map